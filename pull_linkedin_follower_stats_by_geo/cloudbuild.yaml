steps:
  - name: python
    entrypoint: python
    args: ["-m", "pip", "install", "--upgrade", "pip", "--user"]
  - name: python
    entrypoint: python
    args: ["-m", "pip", "install", "-r", "requirements.txt", "--user"]
    dir: 'pull_linkedin_follower_stats_by_geo'
  - name: python
    entrypoint: python
    args: ["-m", "pytest", "-v", "--cov"]
    secretEnv: ['TOKEN']
    dir: 'pull_linkedin_follower_stats_by_geo'
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['functions', 'deploy', 'pull_linkedin_follower_stats_by_geo_cicd', '--trigger-http', '--runtime', 'python311', '--entry-point', 'validate_http', '--set-secrets', 'TOKEN=projects/13410613811/secrets/linkedin_api_access_token:latest']
    dir: 'pull_linkedin_follower_stats_by_geo'
options:
  logging: CLOUD_LOGGING_ONLY
availableSecrets:
  secretManager:
  - versionName: projects/$PROJECT_ID/secrets/linkedin_api_access_token/versions/latest
    env: 'TOKEN'
